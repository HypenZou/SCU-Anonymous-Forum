webpackJsonp([8],{k3zx:function(t,e){},l0qE:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("3cXf"),o=s.n(a),i=s("IHPB"),n=s.n(i),l=s("lC5x"),r=s.n(l),c=s("J0Oq"),v=s.n(c),d=(s("rVsN"),s("wst3")),m=s("RzMJ");s("CtzY");var p=function(t,e){try{if(localStorage.getItem("shieldPostId"))e=JSON.parse(localStorage.getItem("shieldPostId"))}catch(t){e=void 0}return e?(t.forEach(function(t){e.includes(t.id)&&(t.filterLevel=2)}),t):t},_={name:"postsList",components:{MescrollVue:d.a},data:function(){return{bottomDrawer:{showBottomDrawer:!1,chooseIndex:0,dislike_num:0},timestamp:(new Date).getTime(),map:m.a,loadingMessage:"正在加载",mescroll:null,mescrollDown:{callback:this.refreshData,use:!0},mescrollUp:{callback:this.getMorePosts,onScroll:this.onScroll,noMoreSize:3},snackbar:{show:!1,message:"",color:""},items:[],topPosts:[],openWhyFoldedDialog:!1,category:{types:["主干道","校园","社会","情感","娱乐","体育","其他"],selected:0},shieldExplainContent:sessionStorage.getItem("shieldExplainContent")||' <span>『火锅底料』社区是一个以匿名发言为主的社区,</span> <span> 但是可以想见的是,匿名带来的自由,可能会滑向我们所不可控的方向。 <br /> </span> <span>我们希望为大家提供畅所欲言的平台,</span> <span> <strong>但是平台的健康运行,需要我们共同的努力。</strong> <br /> </span> <span> 原则上,『火锅底料』会 <strong>避免删帖</strong> ， <br /> </span> <span> 对于一些『一般人价值判断』下有争议性的话题, <strong>则会折叠处理</strong> 。 <br /> </span> <span> 希望大家在发"性话题","引战话题","令人不适话题","政治相关话题","未经证实话题",的时候, <strong>自觉添加上标签。</strong> <br /> 现行管理制度下,管理员有权利将应该加标签却没加标签的帖子加上标签,并对发帖人以一天禁言的处罚。<br> </span> <span><strong>我们会默认折叠带上标签的内容，</strong></span><br> <span> 您也可以在左上角个人中心-过滤设置中<strong>自定义过滤方式。</strong> </span>'}},created:function(){var t=this;return v()(r.a.mark(function e(){var s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=t,t.$request("get","/forum/getTopPosts",{},{}).then(function(t){s.topPosts=t.data,s.topPosts.map(function(t){return t.top=!0})}).catch(function(t){s.showSnackbar(t)});case 2:case"end":return e.stop()}},e,t)}))()},mounted:function(){},methods:{onScroll:function(t,e,s){this.$store.change_scrollY(e),this.$store.change_isUp(s)},mescrollInit:function(t){this.mescroll=t},showBottomDrawer:function(t){this.bottomDrawer.showBottomDrawer=!0,this.bottomDrawer.chooseIndex=t,this.bottomDrawer.dislike_num=this.items[t].dislike_num},timeFormat:function(t){var e=Math.floor(((new Date).getTime()-new Date(t).getTime())/1e3),s=Math.floor(e/3600/24),a=Math.floor(e/3600)%24,o=Math.floor(e/60)%60,i=Math.floor(e%60),n="";if(i>0&&0==o&&0==a&&0==s)n=i+"秒前";else if(o>0&&0==a&&0==s)n=o+"分钟前";else{if(!(a>0&&0==s))return new Date(new Date(t).getTime()+288e5).toJSON().substr(0,16).replace("T"," ");n=a+"小时前"}return n},getShield:function(){try{var t=localStorage.getItem("shieldTag"),e=Number(localStorage.getItem("shieldTagMethod")),s=Number(localStorage.getItem("shieldPostWordMethod")),a=localStorage.getItem("shieldPostWord");return{shieldTag:t,shieldTagMethod:e,shieldPostWord:a,shieldPostWordMethod:s}}catch(o){return{shieldTag:t,shieldTagMethod:e,shieldPostWord:a,shieldPostWordMethod:s}}},getMorePosts:function(t,e){if("/main/index"==this.$route.path){var s=this;s.$request("get","/forum/getPosts",{timeToken:new Date(s.items[s.items.length-1].latest_comment_time).getTime(),category:s.category.selected}).then(function(a){var o;1===t.num&&(s.items=[]),s.$nextTick(function(){e.endSuccess(a.data.length)}),p(a.data),(o=s.items).push.apply(o,n()(a.data))}).catch(function(t){console.log(t),s.showSnackbar("获取失败"),e.endErr()})}},refreshData:function(t){if("/main/index"==this.$route.path){var e=this;this.$request("get","/forum/getTopPosts",{},{}).then(function(t){e.topPosts=t.data,e.topPosts.map(function(t){return t.top=!0})}).catch(function(t){e.showSnackbar(t)}),e.$request("get","/forum/getPosts",{timeToken:(new Date).valueOf(),category:e.category.selected}).then(function(s){p(s.data),e.items=s.data,e.$nextTick(function(){t.endSuccess(s.data.length)})}).catch(function(s){console.log(s),e.showSnackbar(s),t.endErr()})}},likeOrDislike:function(t,e){var s=this;s.$request("post","/forum/forumLikeOrDislike",{},{postId:Number(s.items[t].id),value:e}).then(function(a){s.showSnackbar(a,"ok"),1==e?s.items[t].like_num++:-1==e&&(s.bottomDrawer.dislike_num++,s.items[t].dislike_num++)}).catch(function(t){console.log(t),s.showSnackbar(t)})},shieldPost:function(t){var e=this.items[t].id;try{if(localStorage.getItem("shieldPostId")){var s=JSON.parse(localStorage.getItem("shieldPostId"));if(s.includes(e))return void this.showSnackbar("已经屏蔽过了");s.push(e),localStorage.setItem("shieldPostId",o()(s)),this.showSnackbar("屏蔽成功!","ok"),this.items.splice(t,1)}else{var a=[];a.push(e),localStorage.setItem("shieldPostId",o()(a)),this.showSnackbar("屏蔽成功!","ok"),this.items.splice(t,1)}}catch(t){localStorage.removeItem("shieldPostId"),this.showSnackbar("屏蔽失败!")}},addCollect:function(t){var e=this;e.$request("post","/forum/addCollect",{},{postId:Number(e.items[t].id)}).then(function(t){e.showSnackbar(t,"ok")}).catch(function(t){e.showSnackbar(t)})}},activated:function(){console.log(this.$store.state.scrollYLeave),this.mescroll.scrollTo(this.$store.state.scrollYLeave,0)},watch:{openWhyFoldedDialog:function(t){this.$store.change_dialog(t,"openWhyFoldedDialog")},secretDialog:function(t){this.$store.change_dialog(t,"secretDialog")},"$store.state.dialog":function(t){"openWhyFoldedDialog"==this.$store.state.dialogName?this.openWhyFoldedDialog=t:"secretDialog"==this.$store.state.dialogName&&(this.secretDialog=t)}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("v-btn",{staticClass:"edit",staticStyle:{"z-index":"99",top:"90.2%"},attrs:{fab:"",color:"primary",large:"",fixed:""},on:{click:function(e){t.$router.push("/edit"),t.$store.change_scrollYLeave()}}},[s("v-icon",{attrs:{color:"white",large:""}},[t._v("mdi-pencil")])],1),t._v(" "),s("div",{ref:"viewBox",staticClass:"mescroll_container postList_container"},[s("mescroll-vue",{ref:"mescroll",attrs:{down:t.mescrollDown,up:t.mescrollUp},on:{init:t.mescrollInit}},[s("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,o=e.attrs;return[s("span",t._g(t._b({staticClass:"d-flex justify-end",staticStyle:{"margin-left":"50%","margin-right":"10px"}},"span",o,!1),a),[s("span",{staticClass:"mr-2 text_thick"},[t._v(t._s(t.category.types[t.category.selected]))]),t._v(" "),s("v-icon",[t._v("mdi-filter-variant")])],1)]}}])},[t._v(" "),s("v-list",t._l(t.category.types,function(e,a){return s("v-list-item",{key:a,on:{click:function(e){t.category.selected=a,t.refreshData(t.mescroll)}}},[s("v-list-item-title",{class:t.category.selected==a?"red--text":""},[t._v(t._s(e))])],1)}),1)],1),t._v(" "),0==t.category.selected?s("div",[s("v-card",{staticClass:"d-flex justify-center align-center tag_on_card",staticStyle:{overflow:"visible"},attrs:{width:"54px",height:"25px",color:"primary"}},[s("span",{staticClass:"text_white text_thick"},[t._v("置顶")])]),t._v(" "),s("v-carousel",{staticClass:"mb-3 mt-n6",staticStyle:{overflow:"visible"},attrs:{height:"180px","hide-delimiter-background":"",light:"",cycle:"",touchless:"",interval:"3000"}},t._l(t.topPosts,function(e,a){return s("v-carousel-item",{key:a},[s("v-card",{attrs:{width:"100%",height:"180px",flat:""},on:{click:function(s){t.$router.push({path:"/postDetail",query:e}),t.$store.change_scrollYLeave()}}},[s("v-card-title",{staticClass:"top_card_title_2",attrs:{absolute:""},domProps:{innerHTML:t._s(e.title_html)}}),t._v(" "),s("v-img",{staticClass:"top_card_background",staticStyle:{position:"absolute",right:"30px"},attrs:{absolute:"",width:"180px",src:e.image_html,contain:""}})],1)],1)}),1)],1):t._e(),t._v(" "),t._l(t.items,function(e,a){return s("div",{key:a},[0==e.filterLevel?s("v-card",{staticClass:"mb-3 mx-auto rounded-lg",attrs:{width:"100%",flat:"",rounded:""},on:{click:function(s){t.$router.push({path:"/postDetail",query:e}),t.$store.change_scrollYLeave()}}},[s("v-card-title",{staticClass:"pt-2 pb-0 d-flex"},[s("v-avatar",{attrs:{size:"45px"}},[s("img",{attrs:{src:e.avatar,alt:"John"}})]),t._v(" "),s("span",{staticClass:"d-flex flex-column justify-center ml-2"},[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"text_small text_thick"},[t._v("#"+t._s(e.thread_starter_name))]),t._v(" "),null!=e.vote?s("v-chip",{staticClass:"mt-2 ml-2 px-2 d-flex align-center",attrs:{outlined:"","x-small":"",color:"primary"}},[s("span",{},[t._v("投票")])]):t._e(),t._v(" "),null!=e.digest?s("v-chip",{staticClass:"mt-2 ml-2 px-2 d-flex align-center",attrs:{outlined:"","x-small":"",color:"primary"}},[s("span",{},[t._v("加精")])]):t._e()],1),t._v(" "),s("span",{staticClass:"text_small-- text_grey mt-n2"},[t._v(t._s(t.timeFormat(e.latest_comment_time)))])]),t._v(" "),s("v-spacer"),t._v(" "),s("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showBottomDrawer(a)}}},[s("v-icon",{attrs:{size:"30px"}},[t._v("mdi-dots-vertical")])],1)],1),t._v(" "),s("v-card-text",{staticClass:"mt-1 d-flex flex-column pb-0"},[s("span",{staticClass:"text_small text_thick text_black"},[t._v(t._s(e.title))]),t._v(" "),s("span",{staticClass:"text_small--- line_three"},[t._v(t._s(e.content))]),t._v(" "),s("div",{staticClass:"d-flex"},["无"!=e.tag?s("v-chip",{staticClass:"ma-1",attrs:{color:"black",outlined:"",small:""}},[s("v-icon",{attrs:{left:"",size:"20px"}},[t._v(t._s(t.map.tagToIcon[e.tag]))]),t._v(" "),s("span",[t._v(t._s(e.tag))])],1):t._e(),t._v(" "),s("v-chip",{staticClass:"ma-1",attrs:{color:"primary",outlined:"",small:""}},[s("v-icon",{attrs:{left:"",size:"20px"}},[t._v(t._s(t.map.categoryToAvatar[e.category]))]),t._v(" "),s("span",[t._v(t._s(e.category))])],1)],1),t._v(" "),s("span",{staticClass:"d-flex align-center"},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){return e.stopPropagation(),t.likeOrDislike(a,1)}}},[s("v-icon",{attrs:{size:"22px",color:"black"}},[t._v("mdi-thumb-up-outline")])],1),t._v(" "),s("span",{staticClass:"ml-1"},[t._v(t._s(e.like_num))]),t._v(" "),s("v-avatar",{staticClass:"ml-5",attrs:{icon:"",size:"40px"}},[s("v-icon",{attrs:{size:"22px",color:"black"}},[t._v("mdi-eye-outline")])],1),t._v(" "),s("span",[t._v(t._s(e.visit_num))]),t._v(" "),s("v-avatar",{staticClass:"ml-6",attrs:{icon:"",size:"40px"}},[s("v-icon",{attrs:{size:"22px",color:"black"}},[t._v("mdi-comment-processing-outline")])],1),t._v(" "),s("span",[t._v(t._s(e.comment_num))])],1)])],1):t._e(),t._v(" "),1==e.filterLevel?s("v-card",{staticClass:"mb-3 mx-auto rounded-lg",attrs:{width:"100%",flat:"",rounded:""},on:{click:function(s){t.$router.push({path:"/postDetail",query:e}),t.$store.change_scrollYLeave()}}},[s("v-card-title",{staticClass:"pt-2 pb-0 d-flex"},[s("v-avatar",{attrs:{size:"45px"}},[s("img",{attrs:{src:e.avatar,alt:"John"}})]),t._v(" "),s("span",{staticClass:"d-flex flex-column justify-center ml-2"},[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"text_small text_thick"},[t._v("#"+t._s(e.thread_starter_name))]),t._v(" "),null!=e.vote?s("v-chip",{staticClass:"mt-2 ml-2 px-2 d-flex align-center",attrs:{outlined:"","x-small":"",color:"primary"}},[s("span",{},[t._v("投票")])]):t._e(),t._v(" "),null!=e.digest?s("v-chip",{staticClass:"mt-2 ml-2 px-2 d-flex align-center",attrs:{outlined:"","x-small":"",color:"primary"}},[s("span",{},[t._v("加精")])]):t._e()],1),t._v(" "),s("span",{staticClass:"text_small-- text_grey mt-n2"},[t._v(t._s(t.timeFormat(e.latest_comment_time)))])]),t._v(" "),s("v-spacer"),t._v(" "),s("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showBottomDrawer(a)}}},[s("v-icon",{attrs:{size:"30px"}},[t._v("mdi-dots-vertical")])],1)],1),t._v(" "),s("v-card-text",{staticClass:"pb-0"},[s("div",{staticClass:"d-flex flex-column"},[s("div",{staticClass:"d-flex align-center"},[s("div",{staticClass:"text-decoration-line-through text_small text_thick black--text"},[t._v("【已折叠 】")]),t._v(" "),s("v-btn",{staticClass:"pa-0",attrs:{fab:"","x-small":"",text:""}},[s("v-icon",{attrs:{size:"20px",color:"black"},on:{click:function(e){e.stopPropagation(),t.openWhyFoldedDialog=!0}}},[t._v("mdi-help-circle")])],1)],1),t._v(" "),s("div",[s("v-expansion-panels",{attrs:{flat:""}},[s("v-expansion-panel",[s("v-expansion-panel-header",{staticClass:"d-flex justify-start",on:{click:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"actions",fn:function(){return[s("v-icon",{staticClass:"mt-n2",attrs:{size:"30px"}},[t._v("mdi-chevron-down")])]},proxy:!0}],null,!0)},[t._v(" "),"无"!=e.tag?s("div",{style:e.tag.length>2?"width:35px":"width:0px"},[s("v-chip",{staticClass:"mt-n1 mb-1",attrs:{color:"black",outlined:"",small:""}},[s("v-icon",{attrs:{left:"",size:"20px"}},[t._v(t._s(t.map.tagToIcon[e.tag]))]),t._v(" "),s("span",[t._v(t._s(e.tag))])],1)],1):t._e(),t._v(" "),s("div",{staticStyle:{width:"60px"}},[s("v-chip",{staticClass:"mt-n1 mb-1",attrs:{color:"primary",outlined:"",small:""}},[s("v-icon",{attrs:{left:"",size:"20px"}},[t._v(t._s(t.map.categoryToAvatar[e.category]))]),t._v(" "),s("span",[t._v(t._s(e.category))])],1)],1),t._v(" "),s("v-spacer")],1),t._v(" "),s("v-expansion-panel-content",{staticClass:"mt-n3",staticStyle:{"border-radius":"10px",overflow:"hidden"},attrs:{color:"grey lighten-4"}},[s("div",{staticClass:"d-flex flex-column"},[s("span",{staticClass:"text_thick black--text text_small line_one"},[t._v(t._s(e.title))]),t._v(" "),s("span",{staticClass:"text_small--- grey--text line_three"},[t._v(t._s(e.content))])])])],1)],1)],1)]),t._v(" "),s("div",{staticClass:"d-flex align-center mt-n1"},[s("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){return e.stopPropagation(),t.likeOrDislike(a,1)}}},[s("v-icon",{attrs:{size:"22px",color:"black"}},[t._v("mdi-thumb-up-outline")])],1),t._v(" "),s("span",{staticClass:"ml-1"},[t._v(t._s(e.like_num))]),t._v(" "),s("v-avatar",{staticClass:"ml-5",attrs:{icon:"",size:"40px"}},[s("v-icon",{attrs:{size:"22px",color:"black"}},[t._v("mdi-eye-outline")])],1),t._v(" "),s("span",[t._v(t._s(e.visit_num))]),t._v(" "),s("v-avatar",{staticClass:"ml-6",attrs:{icon:"",size:"40px"}},[s("v-icon",{attrs:{size:"22px",color:"black"}},[t._v("mdi-comment-processing-outline")])],1),t._v(" "),s("span",[t._v(t._s(e.comment_num))])],1)])],1):t._e()],1)})],2)],1),t._v(" "),s("v-dialog",{attrs:{overlay:!1,"max-width":"500px",transition:"dialog-transition",dark:""},model:{value:t.openWhyFoldedDialog,callback:function(e){t.openWhyFoldedDialog=e},expression:"openWhyFoldedDialog"}},[s("v-card",{staticStyle:{"background-color":"#363636"}},[s("v-card-title",[s("v-icon",[t._v("mdi-help-circle")]),t._v(" "),s("span",{staticClass:"ml-1 white--text"},[t._v("『火锅底料』的折叠机制")])],1),t._v(" "),s("v-divider"),t._v(" "),s("v-card-text",{staticClass:"mt-2"},[s("div",{domProps:{innerHTML:t._s(t.shieldExplainContent)}})])],1)],1),t._v(" "),s("v-snackbar",{attrs:{top:"",color:t.snackbar.color,app:""},scopedSlots:t._u([{key:"action",fn:function(e){var a=e.attrs;return[s("v-btn",t._b({attrs:{color:"white",text:""},on:{click:function(e){t.snackbar.show=!1}}},"v-btn",a,!1),[s("v-icon",[t._v("mdi-close")])],1)]}}]),model:{value:t.snackbar.show,callback:function(e){t.$set(t.snackbar,"show",e)},expression:"snackbar.show"}},[t._v("\n    "+t._s(t.snackbar.message)+"\n    ")]),t._v(" "),s("v-navigation-drawer",{staticStyle:{height:"24%","z-index":"99"},attrs:{dark:"",bottom:"",fixed:"",touchless:""},model:{value:t.bottomDrawer.showBottomDrawer,callback:function(e){t.$set(t.bottomDrawer,"showBottomDrawer",e)},expression:"bottomDrawer.showBottomDrawer"}},[s("div",[s("v-btn",{attrs:{text:"",outlined:"",width:"100%",height:"8vh"},on:{click:function(e){return t.likeOrDislike(t.bottomDrawer.chooseIndex,-1)}}},[s("v-icon",[t._v("mdi-alert-decagram-outline")]),t._v(" "),s("span",{staticClass:"ml-2"},[t._v("举报")]),t._v(" "),s("span",{staticClass:"ml-1 text_xsmall grey--text"},[t._v("【举报数:"+t._s(t.bottomDrawer.dislike_num)+"】")])],1),t._v(" "),s("v-btn",{attrs:{text:"",outlined:"",width:"100%",height:"8vh"},on:{click:function(e){return t.shieldPost(t.bottomDrawer.chooseIndex)}}},[s("v-icon",[t._v("mdi-close-box-multiple-outline")]),t._v(" "),s("span",{staticClass:"ml-2"},[t._v("屏蔽")])],1),t._v(" "),s("v-btn",{attrs:{text:"",outlined:"",width:"100%",height:"8vh"},on:{click:function(e){return t.addCollect(t.bottomDrawer.chooseIndex)}}},[s("v-icon",[t._v("mdi-bookmark-multiple-outline")]),t._v(" "),s("span",{staticClass:"ml-2"},[t._v("收藏")])],1)],1)])],1)},staticRenderFns:[]};var u=s("C7Lr")(_,h,!1,function(t){s("k3zx")},null,null);e.default=u.exports}});
//# sourceMappingURL=8.0b0bcef535c96ac55905.js.map